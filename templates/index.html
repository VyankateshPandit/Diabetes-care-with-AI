<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ _('Diabetes Prediction') }}</title>
  <link rel="icon" href="{{ url_for('static', filename='stethoscope.png') }}" type="image/png" />

  <!-- Tailwind Dark Mode Config -->
  <script>
    tailwind.config = {
      darkMode: 'class'
    }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
     body {
      background-image:
        radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.05) 0%, transparent 40%),
        radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.05) 0%, transparent 40%);
      background-repeat: repeat;
      background-size: 200px 200px;
    }

    @media print {
      body * { visibility: hidden; }
      #printableReport, #printableReport * { visibility: visible; }
      #printableReport { position: absolute; left: 0; top: 0; width: 100%; }
      .no-print { display: none !important; }
    }
    .lang-dropdown { max-height: 0; overflow: hidden; transition: max-height 0.2s ease-out; }
    .lang-dropdown.show { max-height: 300px; }
    
  </style>
</head>

<body class="min-h-screen bg-gradient-to-br 
from-blue-50 via-blue-100 to-blue-200 
dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 
flex flex-col font-sans">

  <!-- Dark Mode Toggle -->
  <div class="fixed top-6 right-6 z-50">
    <button id="darkModeToggle"
      class="px-4 py-2 rounded-xl bg-blue-700 text-white hover:bg-blue-800 transition">
      üåô Dark
    </button>
  </div>

  <main class="flex-grow flex items-center justify-center p-8">
    <section class="bg-white dark:bg-slate-800 bg-opacity-90 dark:bg-opacity-90
      backdrop-blur-md rounded-3xl shadow-2xl max-w-lg w-full p-12 space-y-10">

      <h1 class="text-4xl font-extrabold text-blue-900 dark:text-blue-300 flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-11 w-11 text-blue-700 dark:text-blue-400" fill="none"
          viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M9 12h6m-3-3v6m-6 4h12a2 2 0 002-2V7a2 2 0 00-2-2H6a2 2 0 00-2 2v9a2 2 0 002 2z" />
        </svg>
        Diabetes Prediction
      </h1>

      <form class="space-y-6">
        <!-- Input Template -->
        <div>
          <label class="block text-blue-800 dark:text-blue-300 font-semibold mb-2">Pregnancies</label>
          <input type="number"
            class="w-full rounded-xl border border-blue-300 dark:border-slate-600 
            bg-white dark:bg-slate-700 text-blue-900 dark:text-white
            placeholder-blue-400 dark:placeholder-slate-400
            focus:ring-4 focus:ring-blue-300 dark:focus:ring-blue-500
            px-5 py-3" placeholder="2">
        </div>

        <div>
          <label class="block text-blue-800 dark:text-blue-300 font-semibold mb-2">Glucose</label>
          <input type="number" class="w-full rounded-xl border border-blue-300 dark:border-slate-600 
            bg-white dark:bg-slate-700 text-blue-900 dark:text-white px-5 py-3" placeholder="130">
        </div>

        <div>
          <label class="block text-blue-800 dark:text-blue-300 font-semibold mb-2">Blood Pressure</label>
          <input type="number" class="w-full rounded-xl border border-blue-300 dark:border-slate-600 
            bg-white dark:bg-slate-700 text-blue-900 dark:text-white px-5 py-3" placeholder="70">
        </div>

        <div>
          <label class="block text-blue-800 dark:text-blue-300 font-semibold mb-2">BMI</label>
          <input type="number" step="0.1"
            class="w-full rounded-xl border border-blue-300 dark:border-slate-600 
            bg-white dark:bg-slate-700 text-blue-900 dark:text-white px-5 py-3" placeholder="28.5">
        </div>

        <button type="submit"
          class="w-full bg-blue-700 hover:bg-blue-800 text-white font-extrabold
          rounded-2xl py-4 shadow-lg transition-transform hover:scale-105">
          üîç Predict
        </button>
      </form>

      <div id="predictionResult"
        class="bg-blue-100 dark:bg-slate-700 border border-blue-400 dark:border-blue-600
        rounded-3xl p-6 text-blue-900 dark:text-white text-center font-semibold">
        Result will appear here
      </div>
    </section>
  </main>

  <!-- Chatbot Button -->
  <a href="chatbot.html"
    class="fixed bottom-8 right-8 bg-blue-700 dark:bg-blue-600 
    hover:bg-blue-800 dark:hover:bg-blue-500
    text-white rounded-full w-16 h-16 flex items-center justify-center
    shadow-lg transition-transform hover:scale-110 z-50">
    ü§ñ
  </a>


  <script>
    document.getElementById('lang-btn').addEventListener('click', function(e) {
      e.stopPropagation();
      document.getElementById('lang-dropdown').classList.toggle('show');
    });
    document.addEventListener('click', function() {
      document.getElementById('lang-dropdown').classList.remove('show');
    });
    function setLanguage(langCode) {
      fetch('/api/set-language', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ language: langCode })
      })
      .then(response => response.json())
      .then(data => { if (data.success) window.location.reload(); })
      .catch(err => console.error('Language switch failed:', err));
    }

    // Print and PDF Download Functions
    function getInputValues() {
      return {
        'Pregnancies': document.getElementById('Pregnancies')?.value || 'N/A',
        'Glucose Level': document.getElementById('Glucose')?.value || 'N/A',
        'Blood Pressure': document.getElementById('BloodPressure')?.value || 'N/A',
        'Skin Thickness': document.getElementById('SkinThickness')?.value || 'N/A',
        'Insulin Level': document.getElementById('Insulin')?.value || 'N/A',
        'BMI': document.getElementById('BMI')?.value || 'N/A',
        'Diabetes Pedigree Function': document.getElementById('DiabetesPedigreeFunction')?.value || 'N/A',
        'Age': document.getElementById('Age')?.value || 'N/A'
      };
    }

    function formatDate() {
      return new Date().toLocaleString('en-US', {
        year: 'numeric', month: 'long', day: 'numeric',
        hour: '2-digit', minute: '2-digit'
      });
    }

    function prepareReport() {
      const reportDate = document.getElementById('reportDate');
      const reportInputValues = document.getElementById('reportInputValues');
      
      if (reportDate) reportDate.textContent = 'Date: ' + formatDate();
      
      if (reportInputValues) {
        const values = getInputValues();
        reportInputValues.innerHTML = Object.entries(values)
          .map(([key, val]) => '<li><strong>' + key + ':</strong> ' + val + '</li>')
          .join('');
      }
    }

    function printReport() {
      prepareReport();
      const printableReport = document.getElementById('printableReport');
      if (printableReport) {
        printableReport.classList.remove('hidden');
        window.print();
        setTimeout(() => printableReport.classList.add('hidden'), 100);
      }
    }

    function downloadPDF() {
      prepareReport();
      const printableReport = document.getElementById('printableReport');
      if (printableReport && typeof html2pdf !== 'undefined') {
        printableReport.classList.remove('hidden');
        const opt = {
          margin: 10,
          filename: 'diabetes-prediction-report-' + Date.now() + '.pdf',
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        html2pdf().set(opt).from(printableReport).save().then(() => {
          printableReport.classList.add('hidden');
        });
      } else {
        alert('PDF generation is not available. Please try the Print option instead.');
      }
    }
  </script>

  <script>
  const toggle = document.getElementById('darkModeToggle');
  const html = document.documentElement;

  // Load saved theme
  if (localStorage.getItem('theme') === 'dark') {
    html.classList.add('dark');
    toggle.textContent = '‚òÄ Light';
  }

  toggle.addEventListener('click', () => {
    html.classList.toggle('dark');
    const isDark = html.classList.contains('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    toggle.textContent = isDark ? '‚òÄ Light' : 'üåô Dark';
  });
</script>

</body>

</html>